---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<Base title="Home">
  <!-- Hero -->
  <section class="py-16 text-center">
    <h1 class="font-display text-5xl font-bold tracking-widest mb-4">
      BUILDS CHARACTER
    </h1>
    <p class="text-lg text-slate max-w-2xl mx-auto mb-2">
      Thank Yourself Later.
    </p>
    <p class="text-slate max-w-2xl mx-auto mb-8">
      For people who choose the hard way on purpose.
    </p>
    <div class="flex gap-4 justify-center">
      <a
        href="/field-notes"
        class="bg-rust text-offwhite px-6 py-3 font-medium hover:bg-rust/90 transition-colors"
      >
        Field Notes
      </a>
      <a
        href="/equipment"
        class="border border-charcoal px-6 py-3 font-medium hover:bg-charcoal hover:text-offwhite transition-colors"
      >
        Equipment
      </a>
    </div>
  </section>

  <!-- Recent Posts -->
  {posts.length > 0 && (
    <section class="py-12">
      <h2 class="font-display text-2xl font-bold mb-8">Recent</h2>
      <div class="grid gap-8 md:grid-cols-3">
        {posts.map((post) => (
          <a href={`/field-notes/${post.id}`} class="group">
            <article class="border border-charcoal/10 p-6 hover:border-rust/40 transition-colors h-full">
              <time class="text-sm text-slate">
                {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
              </time>
              <h3 class="font-display font-bold text-lg mt-2 group-hover:text-rust transition-colors">
                {post.data.title}
              </h3>
              <p class="text-slate mt-2 text-sm">
                {post.data.description}
              </p>
            </article>
          </a>
        ))}
      </div>
    </section>
  )}

  <!-- Email Capture -->
  <section class="py-12 border-t border-charcoal/10">
    <div class="text-center">
      <h2 class="font-display text-2xl font-bold mb-3">The Logbook</h2>
      <p class="text-slate mb-6 max-w-lg mx-auto">
        Periodic dispatches on effort, discipline, and the long game.
      </p>
      <form id="logbook-form" class="flex flex-col sm:flex-row gap-3 justify-center max-w-md mx-auto">
        <input type="email" name="email" placeholder="your@email.com" required class="flex-1 px-4 py-3 border border-charcoal/20 bg-cream text-charcoal placeholder:text-slate/50 focus:outline-none focus:border-rust" />
        <button type="submit" class="bg-charcoal text-offwhite px-6 py-3 font-medium hover:bg-charcoal/80 transition-colors">Subscribe</button>
      </form>
      <p id="logbook-thanks" class="text-slate mt-4 hidden">Noted.</p>
    </div>
  </section>

  <script>
    document.getElementById('logbook-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);
      try {
        await fetch('https://formspree.io/f/PLACEHOLDER', {
          method: 'POST', body: data,
          headers: { 'Accept': 'application/json' },
        });
        form.classList.add('hidden');
        document.getElementById('logbook-thanks').classList.remove('hidden');
      } catch {
        form.classList.add('hidden');
        document.getElementById('logbook-thanks').textContent = 'Something went wrong. Try again later.';
        document.getElementById('logbook-thanks').classList.remove('hidden');
      }
    });
  </script>
</Base>
