---
import Base from '../../layouts/Base.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Base title={post.data.title} description={post.data.description}>
  <article class="max-w-3xl mx-auto">
    <header class="mb-10">
      <div class="flex gap-2 mb-3">
        {post.data.tags.map((tag: string) => (
          <span class="text-xs bg-charcoal/5 px-2 py-1 text-slate">{tag}</span>
        ))}
      </div>
      <h1 class="font-display text-4xl font-bold leading-tight">{post.data.title}</h1>
      <p class="text-slate mt-3">{post.data.description}</p>
      <div class="mt-4 text-sm text-slate">
        <span>{post.data.author}</span>
        <span class="mx-2">|</span>
        <time>{post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
      </div>
    </header>
    <div class="prose prose-charcoal max-w-none
      [&_h2]:font-display [&_h2]:text-2xl [&_h2]:font-bold [&_h2]:mt-10 [&_h2]:mb-4
      [&_h3]:font-display [&_h3]:text-xl [&_h3]:font-bold [&_h3]:mt-8 [&_h3]:mb-3
      [&_p]:text-charcoal/90 [&_p]:leading-relaxed [&_p]:mb-4
      [&_a]:text-rust [&_a]:underline [&_a]:hover:text-rust/80
      [&_blockquote]:border-l-4 [&_blockquote]:border-rust/40 [&_blockquote]:pl-4 [&_blockquote]:italic [&_blockquote]:text-slate
      [&_code]:bg-charcoal/5 [&_code]:px-1 [&_code]:py-0.5 [&_code]:text-sm
      [&_pre]:bg-charcoal [&_pre]:text-offwhite [&_pre]:p-4 [&_pre]:overflow-x-auto
      [&_ul]:list-disc [&_ul]:pl-6 [&_ul]:mb-4
      [&_ol]:list-decimal [&_ol]:pl-6 [&_ol]:mb-4
      [&_li]:mb-1
    ">
      <Content />
    </div>
  </article>
</Base>
